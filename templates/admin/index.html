{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static "admin/css/dashboard.css" %}">
<style>
.dashboard-main {
    margin: 0;
}

/* Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… float */
.recent-actions-container {
    background: white;
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    width: 320px;
    float: left; /* Ø¹Ù„Ø´Ø§Ù† ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± ÙØ¹Ù„Ø§Ù‹ */
    margin-right: 25px;
    margin-bottom: 25px;
}

/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙŠØ¬ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
.stats-container {
    overflow: hidden; /* Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ù€ float ÙŠØ´ØªØºÙ„ */
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.stat-card {
    background: #ae1400;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-left: 5px solid;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.stat-card.primary { border-left-color: #667eea; }
.stat-card.success { border-left-color: #28a745; }
.stat-card.warning { border-left-color: #ffc107; }
.stat-card.danger { border-left-color: #dc3545; }

.stat-number {
    font-size: 32px;
    font-weight: bold;
    display: block;
    margin-bottom: 8px;
    color: #ffffff;
}

.stat-label {
    font-size: 14px;
    color: #bfc3c6;
    font-weight: 600;
}

.stat-subtitle {
    font-size: 12px;
    color: #bfc3c6;
    margin-top: 5px;
}

.sidebar-header {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 20px;
    border-radius: 12px 12px 0 0;
    margin: 0;
}

.sidebar-header h3 {
    color: white;
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.sidebar-content {
    padding: 20px;
    max-height: 600px;
    overflow-y: auto;
    background: #2c3e50;
}

.actions-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.action-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    transition: all 0.2s ease;
    text-decoration: none;
    color: inherit;
}

.action-item:hover {
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.action-item.add { border-left-color: #28a745; }
.action-item.change { border-left-color: #ffc107; }
.action-item.delete { border-left-color: #dc3545; }

.action-icon {
    font-size: 16px;
    background: white;
    padding: 8px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.action-details {
    flex: 1;
}

.action-object {
    font-weight: 600;
    color: #2c3e50;
    font-size: 13px;
    margin-bottom: 4px;
}

.action-meta {
    display: flex;
    gap: 10px;
    font-size: 11px;
    color: #6c757d;
}

.action-type {
    background: #e9ecef;
    padding: 2px 6px;
    border-radius: 3px;
}

.no-data {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.no-data-icon {
    font-size: 32px;
    margin-bottom: 10px;
    opacity: 0.5;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 1200px) {
    .recent-actions-container {
        float: none;
        width: 100%;
        margin-right: 0;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
}

.sidebar-content::-webkit-scrollbar {
    width: 4px;
}

.sidebar-content::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.sidebar-content::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-main">
    <!-- Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
    <div class="recent-actions-container">
        <div class="sidebar-header">
            <h3>ğŸ“Š Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
        </div>
        <div class="sidebar-content">
            {% load log %}
            {% get_admin_log 10 as admin_log for_user user %}
            {% if not admin_log %}
            <div class="no-data">
                <div class="no-data-icon">ğŸ“</div>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</p>
            </div>
            {% else %}
            <div class="actions-list">
                {% for entry in admin_log %}
                <a href="{% if entry.get_admin_url %}{{ entry.get_admin_url }}{% else %}#{% endif %}" 
                   class="action-item {% if entry.is_addition %}add{% elif entry.is_change %}change{% elif entry.is_deletion %}delete{% endif %}">
                    <div class="action-icon">
                        {% if entry.is_addition %}â•
                        {% elif entry.is_change %}âœï¸
                        {% elif entry.is_deletion %}ğŸ—‘ï¸
                        {% else %}ğŸ“{% endif %}
                    </div>
                    <div class="action-details">
                        <div class="action-object">{{ entry.object_repr }}</div>
                        <div class="action-meta">
                            <span class="action-type">
                                {% if entry.content_type %}
                                {{ entry.content_type.name }}
                                {% else %}ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ{% endif %}
                            </span>
                            <span>{{ entry.action_time|date:"H:i" }}</span>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
    <div class="stats-container">
        <div class="stats-grid">
            <div class="stat-card primary">
                <span class="stat-number" id="total-revenue">$0</span>
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</span>
                <div class="stat-subtitle">
                    <span id="course-purchases">0 Ø¹Ù…Ù„ÙŠØ§Øª Ø´Ø±Ø§Ø¡</span> | 
                    <span id="net-profit">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: $0</span>
                </div>
            </div>

            <div class="stat-card success">
                <span class="stat-number" id="total-courses">0</span>
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</span>
                <div class="stat-subtitle">
                    <span id="total-course-students">0 Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</span>
                </div>
            </div>

            <div class="stat-card warning">
                <span class="stat-number" id="total-students">0</span>
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                <div class="stat-subtitle">Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</div>
            </div>

            <div class="stat-card danger">
                <span class="stat-number" id="total-teachers">0</span>
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</span>
                <div class="stat-subtitle">Ù…Ø¹Ù„Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    function fetchRealStats() {
        fetch('/admin/dashboard-stats/')
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-revenue').textContent = '$' + data.total_revenue.toLocaleString();
                document.getElementById('course-purchases').textContent = data.total_purchases + ' Ø¹Ù…Ù„ÙŠØ§Øª Ø´Ø±Ø§Ø¡';
                document.getElementById('net-profit').textContent = 'ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: $' + data.net_profit.toLocaleString();
                document.getElementById('total-courses').textContent = data.total_courses;
                document.getElementById('total-course-students').textContent = data.total_enrollments + ' Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª';
                document.getElementById('total-students').textContent = data.total_students.toLocaleString();
                document.getElementById('total-teachers').textContent = data.total_teachers;
            })
            .catch(error => {
                console.error('Error:', error);
                useFallbackStats();
            });
    }

    function useFallbackStats() {
        const stats = {
            total_revenue: 125000,
            total_purchases: 342,
            net_profit: 87500,
            total_courses: 28,
            total_enrollments: 1567,
            total_students: 2341,
            total_teachers: 32
        };
        
        document.getElementById('total-revenue').textContent = '$' + stats.total_revenue.toLocaleString();
        document.getElementById('course-purchases').textContent = stats.total_purchases + ' Ø¹Ù…Ù„ÙŠØ§Øª Ø´Ø±Ø§Ø¡';
        document.getElementById('net-profit').textContent = 'ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: $' + stats.net_profit.toLocaleString();
        document.getElementById('total-courses').textContent = stats.total_courses;
        document.getElementById('total-course-students').textContent = stats.total_enrollments + ' Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª';
        document.getElementById('total-students').textContent = stats.total_students.toLocaleString();
        document.getElementById('total-teachers').textContent = stats.total_teachers;
    }

    fetchRealStats();
    setInterval(fetchRealStats, 60000);
});
</script>